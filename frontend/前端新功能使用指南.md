# 前端新功能使用指南

## 📦 安装依赖

首先需要安装ECharts图表库：

```bash
cd frontend
npm install echarts
```

## 🎉 新功能列表

### 1. 异步任务进度显示
- ✅ 超过100期数据自动异步处理
- ✅ 实时显示获取进度
- ✅ 任务状态轮询（每2秒更新一次）
- ✅ 完成后自动刷新列表

### 2. 走势图分析
- ✅ 号码走势可视化（ECharts折线图）
- ✅ 支持30/50/100/200期数据展示
- ✅ 红球/蓝球（前区/后区）走势分开显示
- ✅ 响应式图表，支持窗口大小变化

### 3. 频率分析
- ✅ Top 10 热门号码统计
- ✅ 柱状图展示出现频率
- ✅ 出现率百分比计算
- ✅ 数据表格详细展示

### 4. 遗漏值提醒
- ✅ Top 10 长期未出现号码
- ✅ 遗漏值状态标签（正常/较长/长期未出）
- ✅ 自动提醒遗漏值异常号码
- ✅ 颜色标记不同遗漏等级

## 🚀 启动步骤

### 1. 安装依赖

```bash
cd frontend
npm install echarts
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 访问应用

浏览器访问：`http://localhost:5173`

## 📖 功能使用说明

### 异步批量获取

#### 场景1：获取50期（同步）

1. 点击"批量获取历史数据"
2. 输入期数：50
3. 点击"开始获取"
4. **立即返回结果**，显示统计信息
5. 列表自动刷新

#### 场景2：获取500期（异步）

1. 点击"批量获取历史数据"
2. 输入期数：500
3. 点击"开始获取"
4. **显示提示**："任务已创建，正在后台获取数据..."
5. **对话框保持打开**，显示实时进度：
   - 总计：500
   - 成功：逐步增加
   - 跳过：已存在的数据
   - 失败：失败的数据
6. **完成后**：
   - 显示成功消息
   - 自动刷新列表
   - 对话框可手动关闭

### 走势图分析

#### 访问走势图

1. 点击顶部菜单："双色球" → "走势分析"
2. 或点击："大乐透" → "走势分析"

#### 功能介绍

**1. 号码走势图**
- 📊 折线图显示每期号码变化
- 🔴 红球/前区：红色系列
- 🔵 蓝球/后区：蓝色系列
- 🖱️ 鼠标悬停查看详细数值
- 📏 期号自动旋转显示，避免重叠

**2. 频率统计图**
- 📊 柱状图显示Top 10号码
- 📈 出现次数直观对比
- 💯 出现率百分比计算
- 📝 表格详细数据展示

**3. 遗漏值分析**
- ⚠️ 长期遗漏自动提醒
- 🏷️ 状态标签区分：
  - ✅ **刚出现**（遗漏0期）：绿色
  - ℹ️ **正常**（遗漏<10期）：蓝色
  - ⚠️ **较长**（遗漏10-20期）：橙色
  - ❌ **长期未出**（遗漏>20期）：红色

#### 切换期数

- 下拉选择：30/50/100/200期
- 点击"刷新数据"重新加载
- 图表自动更新

## 🎨 界面预览

### 双色球走势图页面

```
┌─────────────────────────────────────────┐
│ [最近50期▼]  [刷新数据]                  │
├─────────────────────────────────────────┤
│ 双色球号码走势图                         │
│ ┌───────────────────────────────────┐  │
│ │  35 ─┐                             │  │
│ │     │ ╱╲  ╱╲                        │  │
│ │  20 ─┘ ╲╱  ╲╱                       │  │
│ │         红球1-6 蓝球               │  │
│ │   0 ─────────────────────────────  │  │
│ └───────────────────────────────────┘  │
├─────────────────────────────────────────┤
│ 红球频率统计(Top 10) │ 蓝球频率统计     │
│ ┌─────────┐          │ ┌─────────┐    │
│ │ 柱状图   │          │ │ 柱状图   │    │
│ └─────────┘          │ └─────────┘    │
│ [号码] [次数] [率]   │ [号码] [次数]   │
├─────────────────────────────────────────┤
│ 红球遗漏值(Top 10)   │ 蓝球遗漏值       │
│ ⚠️ 号码7已连续15期未出现！              │
│ [号码] [遗漏] [状态]  │                 │
└─────────────────────────────────────────┘
```

## 🔧 技术实现

### 异步任务轮询

```javascript
// 自动检测是否需要异步
const useAsync = historyCount.value > 100

// 获取数据
const result = await shuangseqiuAPI.fetchHistory(count, useAsync)

if (result.task_id) {
  // 异步任务，开始轮询
  await pollTask(result.task_id)
}

// 轮询函数
const pollTask = async (taskId) => {
  const pollInterval = setInterval(async () => {
    const task = await taskAPI.getTask(taskId)
    
    // 更新进度
    historyResult.value = {
      total: task.total,
      success: task.success,
      skipped: task.skipped,
      failed: task.failed
    }
    
    // 检查完成状态
    if (task.status === 'completed') {
      clearInterval(pollInterval)
      ElMessage.success('批量获取完成！')
      loadData()
    }
  }, 2000) // 每2秒查询一次
}
```

### ECharts图表

```javascript
import * as echarts from 'echarts'

// 初始化图表
const chart = echarts.init(chartRef.value)

// 配置选项
const option = {
  title: { text: '双色球走势图' },
  tooltip: { trigger: 'axis' },
  legend: { data: ['红球1', '红球2', ...] },
  xAxis: {
    type: 'category',
    data: trendData.value.issues
  },
  yAxis: { type: 'value' },
  series: [
    {
      name: '红球1',
      type: 'line',
      data: trendData.value.red_balls.map(balls => balls[0]),
      smooth: true
    },
    // ... 其他系列
  ]
}

chart.setOption(option)
```

### 响应式处理

```javascript
// 监听窗口大小变化
const handleResize = () => {
  chart?.resize()
}

onMounted(() => {
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
  chart?.dispose()
})
```

## 📊 数据说明

### API响应格式

**走势图数据**：

```javascript
{
  "issues": ["2025100", "2025101", "2025102"],  // 期号列表
  "red_balls": [                                  // 每期红球
    [1, 5, 12, 18, 25, 33],
    [2, 8, 15, 20, 28, 30]
  ],
  "blue_balls": [5, 10],                         // 每期蓝球
  "red_freq": {                                  // 红球频率
    "1": 15,  // 号码1出现15次
    "2": 12
  },
  "blue_freq": {                                 // 蓝球频率
    "1": 8,
    "2": 6
  },
  "red_missing": {                               // 红球遗漏值
    "1": 0,   // 号码1遗漏0期（刚出现）
    "2": 5    // 号码2遗漏5期
  },
  "blue_missing": {                              // 蓝球遗漏值
    "1": 3,
    "2": 0
  }
}
```

### 计算说明

**出现率**：

```javascript
// 红球出现率 = (出现次数 / (期数 * 6)) * 100%
const rate = (count / (limit * 6)) * 100

// 蓝球出现率 = (出现次数 / 期数) * 100%
const rate = (count / limit) * 100
```

**遗漏值**：

- **定义**：号码连续未出现的期数
- **计算**：
  - 最新一期出现 → 遗漏值 = 0
  - N期未出现 → 遗漏值 = N
- **重置**：号码一旦出现，遗漏值归零

## ⚠️ 注意事项

### 1. ECharts依赖

必须安装ECharts：

```bash
npm install echarts
```

### 2. 数据要求

走势图需要数据库中有数据，建议：

1. 先批量获取100期数据
2. 再查看走势图

### 3. 性能优化

- 图表响应式已优化
- 大数据量（>200期）可能加载较慢
- 建议使用50-100期数据

### 4. 浏览器兼容性

- 推荐使用Chrome/Edge/Firefox最新版
- 不支持IE浏览器

## 🐛 常见问题

### Q1：走势图无数据

**原因**：数据库没有数据

**解决**：
1. 进入"开奖记录"页面
2. 点击"批量获取历史数据"
3. 获取至少30期数据
4. 再次访问走势图

### Q2：异步任务一直pending

**原因**：后端任务处理中

**解决**：
- 等待任务完成（大数据量需要时间）
- 查看后端日志确认进度
- 最多等待5分钟（300次轮询）

### Q3：图表不显示

**原因**：ECharts未安装或初始化失败

**解决**：
```bash
npm install echarts
npm run dev
```

### Q4：走势图显示不全

**原因**：窗口大小变化

**解决**：
- 刷新页面
- 或调整浏览器窗口大小（自动适配）

## 🎯 下一步优化建议

1. **导出功能**：支持导出图表为图片
2. **自定义筛选**：按日期范围筛选
3. **对比分析**：多期数据对比
4. **预测功能**：基于历史数据的简单预测
5. **移动端适配**：优化移动设备显示

## 📚 相关文档

- ECharts官方文档：https://echarts.apache.org/
- Vue 3官方文档：https://vuejs.org/
- Element Plus官方文档：https://element-plus.org/

