# æ–°åŠŸèƒ½å¿«é€Ÿæµ‹è¯•æŒ‡å—

## ğŸ‰ å·²å®Œæˆçš„ä¼˜åŒ–å’Œæ–°åŠŸèƒ½

### âœ… ä¼˜åŒ–å†…å®¹
1. **æ‰¹é‡è·å–ä¸Šé™æå‡**ï¼šä»500æœŸæå‡åˆ°2000æœŸ
2. **å¼‚æ­¥ä»»åŠ¡å¤„ç†**ï¼šè¶…è¿‡100æœŸè‡ªåŠ¨å¼‚æ­¥ï¼Œé¿å…è¶…æ—¶
3. **æ™ºèƒ½å¢é‡æ›´æ–°API**ï¼šæä¾›è·å–æœ€æ–°æœŸå·çš„æ¥å£
4. **æ—¥æœŸè§£æå¢å¼º**ï¼šæ”¯æŒå¸¦æ˜ŸæœŸçš„æ—¥æœŸæ ¼å¼ï¼ˆå¦‚ï¼š2024-08-20(äºŒ)ï¼‰

### âœ… æ–°åŠŸèƒ½
1. **èµ°åŠ¿å›¾æ•°æ®API**ï¼šæä¾›åŒè‰²çƒå’Œå¤§ä¹é€çš„èµ°åŠ¿æ•°æ®
2. **å·ç é¢‘ç‡ç»Ÿè®¡**ï¼šç»Ÿè®¡æ¯ä¸ªå·ç çš„å‡ºç°æ¬¡æ•°
3. **é—æ¼å€¼åˆ†æ**ï¼šè®¡ç®—æ¯ä¸ªå·ç è¿ç»­æœªå‡ºç°çš„æœŸæ•°
4. **ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢**ï¼šå®æ—¶æŸ¥è¯¢å¼‚æ­¥ä»»åŠ¡è¿›åº¦

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### 1. å¯åŠ¨åç«¯

```bash
cd backend
go run main.go
```

åº”è¯¥çœ‹åˆ°ï¼š
```
æœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8080
```

### 2. æµ‹è¯•å¼‚æ­¥æ‰¹é‡è·å–ï¼ˆè§£å†³è¶…æ—¶é—®é¢˜ï¼‰

#### æµ‹è¯•åœºæ™¯1ï¼šåŒæ­¥è·å–ï¼ˆå°æ‰¹é‡ï¼‰

```bash
# è·å–50æœŸï¼ˆåŒæ­¥ï¼Œç«‹å³è¿”å›ç»“æœï¼‰
curl -X POST "http://localhost:8080/api/shuangseqiu/fetch-history?count=50"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 0,
  "msg": "æ‰¹é‡è·å–å®Œæˆ",
  "data": {
    "total": 50,
    "success": 45,
    "skipped": 5,
    "failed": 0
  }
}
```

#### æµ‹è¯•åœºæ™¯2ï¼šå¼‚æ­¥è·å–ï¼ˆå¤§æ‰¹é‡ï¼‰

```bash
# è·å–500æœŸï¼ˆè‡ªåŠ¨å¼‚æ­¥ï¼‰
curl -X POST "http://localhost:8080/api/shuangseqiu/fetch-history?count=500"
```

**é¢„æœŸå“åº”**ï¼ˆç«‹å³è¿”å›ä»»åŠ¡IDï¼‰ï¼š
```json
{
  "code": 0,
  "msg": "ä»»åŠ¡å·²åˆ›å»ºï¼Œè¯·é€šè¿‡ä»»åŠ¡IDæŸ¥è¯¢è¿›åº¦",
  "data": {
    "task_id": "20251029163045abc123"
  }
}
```

**æŸ¥è¯¢ä»»åŠ¡è¿›åº¦**ï¼š
```bash
# æ›¿æ¢ä¸ºå®é™…çš„task_id
curl "http://localhost:8080/api/task/20251029163045abc123"
```

**å“åº”ç¤ºä¾‹**ï¼ˆè¿è¡Œä¸­ï¼‰ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": "20251029163045abc123",
    "type": "shuangseqiu",
    "status": "running",
    "progress": 0,
    "total": 500,
    "success": 250,
    "skipped": 10,
    "failed": 0,
    "start_time": "2025-10-29T16:30:45Z"
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼ˆå·²å®Œæˆï¼‰ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": "20251029163045abc123",
    "type": "shuangseqiu",
    "status": "completed",
    "progress": 100,
    "total": 500,
    "success": 485,
    "skipped": 15,
    "failed": 0,
    "start_time": "2025-10-29T16:30:45Z",
    "end_time": "2025-10-29T16:35:30Z",
    "result": {
      "total": 500,
      "success": 485,
      "skipped": 15,
      "failed": 0
    }
  }
}
```

### 3. æµ‹è¯•èµ°åŠ¿å›¾æ•°æ®

#### åŒè‰²çƒèµ°åŠ¿

```bash
# è·å–æœ€è¿‘50æœŸèµ°åŠ¿æ•°æ®
curl "http://localhost:8080/api/shuangseqiu/trend?limit=50"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "issues": ["2024001", "2024002", "2024003"],
    "red_balls": [
      [1, 5, 12, 18, 25, 33],
      [2, 8, 15, 20, 28, 30],
      [3, 9, 16, 22, 29, 31]
    ],
    "blue_balls": [5, 10, 8],
    "red_freq": {
      "1": 15,
      "2": 12,
      "3": 18,
      ...
    },
    "blue_freq": {
      "1": 8,
      "2": 6,
      ...
    },
    "red_missing": {
      "1": 0,   // åˆšå‡ºç°
      "2": 5,   // 5æœŸæœªå‡ºç°
      "3": 12,  // 12æœŸæœªå‡ºç°
      ...
    },
    "blue_missing": {
      "1": 3,
      "2": 0,
      ...
    }
  }
}
```

#### å¤§ä¹é€èµ°åŠ¿

```bash
# è·å–æœ€è¿‘100æœŸèµ°åŠ¿æ•°æ®
curl "http://localhost:8080/api/daletou/trend?limit=100"
```

### 4. æµ‹è¯•æ—¥æœŸè§£æä¿®å¤

å…ˆæ‰¹é‡è·å–ä¸€äº›æ•°æ®ï¼Œåç«¯æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
2025/10/29 16:40:00 åŒè‰²çƒAPIåŸå§‹æ•°æ®: æœŸå·=2024096, çº¢çƒ=..., æ—¥æœŸå­—ç¬¦ä¸²='2024-08-20(äºŒ)'
2025/10/29 16:40:00 åŒè‰²çƒæ•°æ®è§£ææˆåŠŸ: ... DrawDate:2024-08-20 00:00:00 ...
```

âœ… ä¸å†å‡ºç°"è§£ææ—¥æœŸå¤±è´¥"çš„é”™è¯¯

### 5. æµ‹è¯•æ’åºä¿®å¤

```bash
# æŸ¥è¯¢åˆ—è¡¨æ•°æ®
curl "http://localhost:8080/api/shuangseqiu/list?page=1&page_size=5"
```

**é¢„æœŸ**ï¼šæœŸå·æŒ‰å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "list": [
      {"issue": "2025124", ...},  // æœ€æ–°
      {"issue": "2025123", ...},
      {"issue": "2025122", ...},
      {"issue": "2025121", ...},
      {"issue": "2025120", ...}   // è¾ƒæ—§
    ],
    "total": 500,
    "page": 1,
    "size": 5
  }
}
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡ç¤ºä¾‹

### æŸ¥æ‰¾çƒ­é—¨å·ç 

```bash
curl "http://localhost:8080/api/shuangseqiu/trend?limit=100" | jq '.data.red_freq | to_entries | sort_by(.value) | reverse | .[:10]'
```

**è¾“å‡º**ï¼šå‡ºç°é¢‘ç‡æœ€é«˜çš„10ä¸ªçº¢çƒ

### æŸ¥æ‰¾å†·é—¨å·ç 

```bash
curl "http://localhost:8080/api/shuangseqiu/trend?limit=100" | jq '.data.red_freq | to_entries | sort_by(.value) | .[:10]'
```

**è¾“å‡º**ï¼šå‡ºç°é¢‘ç‡æœ€ä½çš„10ä¸ªçº¢çƒ

### æŸ¥æ‰¾é•¿æœŸæœªå‡ºç°çš„å·ç 

```bash
curl "http://localhost:8080/api/shuangseqiu/trend?limit=100" | jq '.data.red_missing | to_entries | sort_by(.value) | reverse | .[:10]'
```

**è¾“å‡º**ï¼šé—æ¼å€¼æœ€å¤§çš„10ä¸ªçº¢çƒ

---

## ğŸ¨ å‰ç«¯é›†æˆå»ºè®®

### 1. æ›´æ–° API æ–‡ä»¶

`frontend/src/api/lottery.js`:

```javascript
// åŒè‰²çƒAPI
export const shuangseqiuAPI = {
  // ... ç°æœ‰æ–¹æ³• ...
  
  // è·å–èµ°åŠ¿æ•°æ®
  getTrend(limit = 50) {
    return request.get('/api/shuangseqiu/trend', {
      params: { limit }
    })
  }
}

// å¤§ä¹é€API
export const daletouAPI = {
  // ... ç°æœ‰æ–¹æ³• ...
  
  // è·å–èµ°åŠ¿æ•°æ®
  getTrend(limit = 50) {
    return request.get('/api/daletou/trend', {
      params: { limit }
    })
  }
}

// ä»»åŠ¡API
export const taskAPI = {
  // è·å–ä»»åŠ¡çŠ¶æ€
  getTask(taskId) {
    return request.get(`/api/task/${taskId}`)
  }
}
```

### 2. ä¼˜åŒ–æ‰¹é‡è·å–ï¼ˆå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼‰

`frontend/src/views/Shuangseqiu.vue`:

```javascript
// æ‰¹é‡è·å–å†å²æ•°æ®
const handleFetchHistory = async () => {
  historyLoading.value = true
  historyResult.value = null
  
  try {
    const result = await shuangseqiuAPI.fetchHistory(historyCount.value)
    
    if (result.task_id) {
      // å¼‚æ­¥ä»»åŠ¡ï¼Œè½®è¯¢æŸ¥è¯¢è¿›åº¦
      ElMessage.info('ä»»åŠ¡å·²åˆ›å»ºï¼Œæ­£åœ¨åå°æ‰§è¡Œ...')
      await pollTask(result.task_id)
    } else {
      // åŒæ­¥å®Œæˆ
      historyResult.value = result
      if (result.success > 0) {
        ElMessage.success(`æˆåŠŸè·å– ${result.success} æœŸæ•°æ®`)
        loadData()
      }
    }
  } catch (error) {
    console.error('æ‰¹é‡è·å–å¤±è´¥:', error)
  } finally {
    historyLoading.value = false
  }
}

// è½®è¯¢ä»»åŠ¡çŠ¶æ€
const pollTask = async (taskId) => {
  const pollInterval = setInterval(async () => {
    try {
      const task = await taskAPI.getTask(taskId)
      
      // æ›´æ–°è¿›åº¦æ˜¾ç¤º
      historyResult.value = {
        total: task.total,
        success: task.success,
        skipped: task.skipped,
        failed: task.failed
      }
      
      if (task.status === 'completed') {
        clearInterval(pollInterval)
        ElMessage.success('æ‰¹é‡è·å–å®Œæˆï¼')
        loadData()
      } else if (task.status === 'failed') {
        clearInterval(pollInterval)
        ElMessage.error('æ‰¹é‡è·å–å¤±è´¥ï¼š' + task.message)
      }
    } catch (error) {
      clearInterval(pollInterval)
      console.error('æŸ¥è¯¢ä»»åŠ¡å¤±è´¥:', error)
    }
  }, 2000) // æ¯2ç§’æŸ¥è¯¢ä¸€æ¬¡
}
```

### 3. æ·»åŠ èµ°åŠ¿å›¾é¡µé¢

åˆ›å»º `frontend/src/views/ShuangseqiuTrend.vue`:

```vue
<template>
  <div class="trend-container">
    <el-card>
      <el-select v-model="limit" @change="loadTrend">
        <el-option label="æœ€è¿‘30æœŸ" :value="30" />
        <el-option label="æœ€è¿‘50æœŸ" :value="50" />
        <el-option label="æœ€è¿‘100æœŸ" :value="100" />
      </el-select>
      
      <div ref="chartRef" style="height: 500px; margin-top: 20px"></div>
    </el-card>
    
    <el-card style="margin-top: 20px">
      <h3>å·ç é¢‘ç‡ç»Ÿè®¡ï¼ˆTop 10ï¼‰</h3>
      <el-table :data="topFreqBalls">
        <el-table-column prop="number" label="å·ç " />
        <el-table-column prop="count" label="å‡ºç°æ¬¡æ•°" />
      </el-table>
    </el-card>
    
    <el-card style="margin-top: 20px">
      <h3>é•¿æœŸæœªå‡ºç°å·ç ï¼ˆTop 10ï¼‰</h3>
      <el-table :data="topMissingBalls">
        <el-table-column prop="number" label="å·ç " />
        <el-table-column prop="missing" label="é—æ¼æœŸæ•°" />
      </el-table>
    </el-card>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import * as echarts from 'echarts'
import { shuangseqiuAPI } from '@/api/lottery'

const chartRef = ref()
const limit = ref(50)
const trendData = ref(null)
let chart

const topFreqBalls = computed(() => {
  if (!trendData.value) return []
  return Object.entries(trendData.value.red_freq)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .map(([number, count]) => ({ number, count }))
})

const topMissingBalls = computed(() => {
  if (!trendData.value) return []
  return Object.entries(trendData.value.red_missing)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .map(([number, missing]) => ({ number, missing }))
})

onMounted(() => {
  chart = echarts.init(chartRef.value)
  loadTrend()
})

const loadTrend = async () => {
  const data = await shuangseqiuAPI.getTrend(limit.value)
  trendData.value = data
  
  const option = {
    title: { text: 'åŒè‰²çƒèµ°åŠ¿å›¾' },
    tooltip: { trigger: 'axis' },
    legend: {
      data: ['çº¢çƒ1', 'çº¢çƒ2', 'çº¢çƒ3', 'çº¢çƒ4', 'çº¢çƒ5', 'çº¢çƒ6', 'è“çƒ']
    },
    xAxis: {
      type: 'category',
      data: data.issues
    },
    yAxis: { 
      type: 'value',
      max: 33
    },
    series: [
      {
        name: 'çº¢çƒ1',
        type: 'line',
        data: data.red_balls.map(balls => balls[0])
      },
      {
        name: 'çº¢çƒ2',
        type: 'line',
        data: data.red_balls.map(balls => balls[1])
      },
      {
        name: 'çº¢çƒ3',
        type: 'line',
        data: data.red_balls.map(balls => balls[2])
      },
      {
        name: 'çº¢çƒ4',
        type: 'line',
        data: data.red_balls.map(balls => balls[3])
      },
      {
        name: 'çº¢çƒ5',
        type: 'line',
        data: data.red_balls.map(balls => balls[4])
      },
      {
        name: 'çº¢çƒ6',
        type: 'line',
        data: data.red_balls.map(balls => balls[5])
      },
      {
        name: 'è“çƒ',
        type: 'line',
        data: data.blue_balls,
        itemStyle: { color: '#409eff' }
      }
    ]
  }
  
  chart.setOption(option)
}
</script>
```

---

## âœ… æµ‹è¯•æ¸…å•

- [ ] åç«¯æˆåŠŸå¯åŠ¨
- [ ] åŒæ­¥æ‰¹é‡è·å–ï¼ˆâ‰¤100æœŸï¼‰æ­£å¸¸å·¥ä½œ
- [ ] å¼‚æ­¥æ‰¹é‡è·å–ï¼ˆ>100æœŸï¼‰è¿”å›ä»»åŠ¡ID
- [ ] ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢æ­£å¸¸
- [ ] åŒè‰²çƒèµ°åŠ¿å›¾APIè¿”å›æ•°æ®
- [ ] å¤§ä¹é€èµ°åŠ¿å›¾APIè¿”å›æ•°æ®
- [ ] æ—¥æœŸè§£ææ­£ç¡®ï¼ˆæ— "è§£æå¤±è´¥"æ—¥å¿—ï¼‰
- [ ] åˆ—è¡¨æŒ‰æœŸå·å€’åºæ’åˆ—
- [ ] å·ç é¢‘ç‡ç»Ÿè®¡æ­£ç¡®
- [ ] é—æ¼å€¼è®¡ç®—æ­£ç¡®

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **å®‰è£… ECharts**ï¼ˆå¦‚æœå‰ç«¯éœ€è¦ï¼‰ï¼š
```bash
cd frontend
npm install echarts
```

2. **æ›´æ–°å‰ç«¯API**ï¼šæŒ‰ç…§ä¸Šé¢çš„ç¤ºä¾‹æ›´æ–° `lottery.js`

3. **åˆ›å»ºèµ°åŠ¿å›¾é¡µé¢**ï¼šå‚è€ƒä¸Šé¢çš„ Vue ç»„ä»¶

4. **æµ‹è¯•å¼‚æ­¥ä»»åŠ¡**ï¼šæµ‹è¯•å¤§æ‰¹é‡æ•°æ®è·å–

---

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

### é—®é¢˜1ï¼šç¼–è¯‘é”™è¯¯

```bash
cd backend
go mod tidy
go build -o caipiao main.go
```

### é—®é¢˜2ï¼šä»»åŠ¡ä¸€ç›´pending

æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤å¼‚æ­¥ä»»åŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚

### é—®é¢˜3ï¼šèµ°åŠ¿å›¾æ— æ•°æ®

ç¡®ä¿æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼š
```bash
sqlite3 backend/data/lottery.db "SELECT COUNT(*) FROM shuangseqiu;"
```

å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå…ˆæ‰¹é‡è·å–ï¼š
```bash
curl -X POST "http://localhost:8080/api/shuangseqiu/fetch-history?count=100"
```

