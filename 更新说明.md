# 更新说明

## v1.1.0 - 2025年10月29日

### ✨ 重要更新

已对接官方彩票数据API，系统现在可以直接从官方接口获取真实数据！

### 🔧 主要改动

#### 1. API配置优化

**之前：** 需要手动配置单一的 BaseURL
```go
API: APIConfig{
    BaseURL: "https://api.example.com",
}
```

**现在：** 已配置双色球和大乐透的官方API，开箱即用
```go
API: APIConfig{
    ShuangseqiuURL: "https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice",
    DaletouURL: "https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry",
}
```

#### 2. 双色球API适配

- ✅ 对接中国福利彩票官方接口
- ✅ 支持按期号查询
- ✅ 自动解析红球（逗号分隔格式）
- ✅ 自动解析蓝球
- ✅ 支持获取最新一期数据

**请求参数：**
- `name`: 游戏名称（固定：ssq）
- `issueCount`: 返回期数
- `issueStart`: 起始期号（可选）
- `issueEnd`: 结束期号（可选）

#### 3. 大乐透API适配

- ✅ 对接中国体育彩票官方接口
- ✅ 支持按期号查询
- ✅ 自动解析前区和后区（空格分隔，#号分隔前后区）
- ✅ 支持获取最新一期数据

**请求参数：**
- `gameNo`: 游戏编号（固定：85）
- `provinceId`: 省份ID（默认：0）
- `pageSize`: 每页条数
- `pageNo`: 页码
- `isVerify`: 是否验证（固定：1）
- `issueStart`: 起始期号（可选）
- `issueEnd`: 结束期号（可选）

#### 4. 代码改进

**服务层优化：**
```go
// 之前：单一BaseURL
type LotteryService struct {
    apiBaseURL string
}

// 现在：分别配置双色球和大乐透API
type LotteryService struct {
    shuangseqiuURL string
    daletouURL     string
}
```

**响应解析优化：**
- 适配双色球官方API响应格式
- 适配大乐透官方API响应格式
- 增强错误处理
- 自动解析不同的数据格式

### 📝 API响应示例

#### 双色球官方API响应

```json
{
  "state": 0,
  "message": "成功",
  "total": 1,
  "result": [
    {
      "name": "双色球",
      "code": "2024001",
      "date": "2024-01-02",
      "week": "星期二",
      "red": "01,05,12,18,23,31",
      "blue": "08",
      "sales": "362043434",
      "poolmoney": "868123456"
    }
  ]
}
```

#### 大乐透官方API响应

```json
{
  "success": true,
  "errorCode": "0",
  "message": "成功",
  "value": {
    "total": 1,
    "list": [
      {
        "lotteryDrawNum": "24001",
        "lotteryDrawTime": "2024-01-01 20:30:00",
        "lotteryDrawResult": "01 05 12 18 23 # 03 08",
        "lotterySaleAmount": "362043434",
        "lotteryPoolAmount": "868123456"
      }
    ]
  }
}
```

### 🚀 使用说明

**无需任何配置！** 直接启动项目即可使用：

```bash
# 启动后端
./start-backend.sh

# 启动前端
./start-frontend.sh

# 访问应用
浏览器打开 http://localhost:5173
```

在页面上点击"获取最新数据"即可从官方API获取真实的开奖数据！

### 📊 测试验证

可以在浏览器中直接测试官方API：

**双色球最新数据：**
```
https://www.cwl.gov.cn/cwl_admin/front/cwlkj/search/kjxx/findDrawNotice?name=ssq&issueCount=1
```

**大乐透最新数据：**
```
https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=85&provinceId=0&pageSize=1&isVerify=1&pageNo=1
```

### ⚠️ 注意事项

1. 这些是公开的官方API，无需认证
2. API调用可能受到频率限制，建议合理控制请求频率
3. 官方API可能会有维护时段，期间可能无法访问
4. 数据格式由官方定义，如果官方调整格式可能需要更新代码

### 🔄 迁移指南

如果您之前使用的是旧版本，需要注意：

1. **配置文件变更**
   - `API.BaseURL` 已替换为 `API.ShuangseqiuURL` 和 `API.DaletouURL`
   - 需要更新 `config.go` 配置

2. **服务层变更**
   - `NewLotteryService` 现在需要两个参数
   - 如有自定义修改，需要相应调整

3. **无需手动配置**
   - 新版本已内置官方API配置
   - 直接使用即可

### 🐛 问题反馈

如遇到问题：
1. 检查网络连接
2. 查看后端日志
3. 在浏览器测试API是否可访问
4. 提交Issue描述具体问题

### 📚 相关文档

- [README.md](README.md) - 完整项目说明
- [backend/API说明.md](backend/API说明.md) - 详细API文档
- [快速开始.md](快速开始.md) - 快速使用指南
- [项目完成总结.md](项目完成总结.md) - 项目总结

---

感谢使用！如有问题欢迎反馈！ 🎉

